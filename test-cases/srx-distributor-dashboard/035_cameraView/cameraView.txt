*** Settings ***
Suite Setup                         Preparation
Suite Teardown                      Finish Suite
Library                             String
Library                             SeleniumLibrary
Library                             ImapLibrary
Library                             RequestsLibrary
Resource                            ../../../resources/resource.robot
Resource                            ../../../resources/testData.robot

*** Test Case ***
Checking Date Of Last Screen
    ${full date string}             Get Text            xpath:/html/body/div/div/div/div/div/div[2]/div/div[2]/div/div/div[3]/div/div/div/div/div[1]/div[2]/table/tbody/tr[1]/td[2]/div
    ${date}     ${full time}        Split String        ${full date string}        ,
    ${month}    ${day}    ${year}   Split String        ${date}                    /
    ${time}     ${AM PM}            Split String        ${full time}
    ${true hours}    ${minutes}     Split String        ${time}                    :
    Run Keyword If                  ${true hours}
    Set Global Variable             ${year}
    Set Global Variable             ${month}
    Set Global Variable             ${day}
    Set Global Variable             ${hours}
    Set Global Variable             ${minutes}

Create Request
    ${current locker}               Get Text                    xpath:/html/body/div/div/div/div/div/div[2]/div/div[2]/div/div/div[3]/div/div/div/div/div[1]/div[2]/table/tbody/tr[1]/td[4]/div
    Run Keyword If                  ${current locker}==8080     If First        ELSE        If Second
    Create Session                  httpbin                     https://${APIKEY}:${APIKEY}@api-dev.storeroomlogix.com/api/webhook/events/locker        verify=true
    &{headers}=                     Create Dictionary           Content-Type=application/json
    ${error}=                       Post Request                httpbin    /        data={ "currentWeight": 0, "distributorSku": "AB 1492-J3", "kioskId": 59, "lastWeight": 0, "location1": 1, "location2": 11, "location3": 111, "lockerId": ${new locker}, "quantityIssued": 10, "quantityRequested": 10, "timestamp": "${year}-${month}-${day}T${hours}-2:${minutes}:59.999", "transactionStatus": "Available", "weightOfProduct": 0 }    headers=${headers}
    Reload Page
    ${current locker}               Get Text                    xpath:/html/body/div/div/div/div/div/div[2]/div/div[2]/div/div/div[3]/div/div/div/div/div[1]/div[2]/table/tbody/tr[1]/td[4]/div
    Should Be Equal As Integers     ${current locker}           ${new locker}

*** Keywords ***
Preparation
    Goto Camera View

If First
    Set Global Variable             ${new locker}               1661

If Second
    Set Global Variable             ${new locker}               8080
